# =============================================================================
# MongoDB to YugabyteDB YSQL Migration Configuration
# =============================================================================

# =============================================================================
# MongoDB Connection Settings
# =============================================================================
mongo.uri=mongodb://localhost:27017
mongo.database=transaction_datastore
mongo.collection=transactions_flat
mongo.readPreference=primaryPreferred
mongo.batchSize=1000
# Partitioning (optional)
mongo.partition.field=_id
mongo.partition.strategy=sample
# Optional aggregation pipeline (JSON array as string)
mongo.pipeline=[]

# =============================================================================
# YugabyteDB Connection Settings
# =============================================================================
yugabyte.host=localhost
yugabyte.port=5433
yugabyte.database=transaction_datastore
yugabyte.username=yugabyte
yugabyte.password=yugabyte
# Truncate target table before migration (default: true)
# yugabyte.truncateTargetTable=true

# YugabyteDB Connection Pool Settings
yugabyte.maxPoolSize=8
yugabyte.minIdle=2
yugabyte.connectionTimeout=30000
yugabyte.idleTimeout=300000
yugabyte.maxLifetime=1800000

# YugabyteDB JDBC Parameters (COPY-optimized)
yugabyte.loadBalanceHosts=true
yugabyte.reWriteBatchedInserts=true
yugabyte.tcpKeepAlive=true
yugabyte.binaryTransfer=false
yugabyte.socketTimeout=0
yugabyte.loginTimeout=10
# Topology keys for stretch clusters (optional)
# yugabyte.topologyKeys=

# YugabyteDB Insert Mode Configuration
yugabyte.insertMode=COPY
yugabyte.insertBatchSize=300

# YugabyteDB COPY Settings
yugabyte.copyBufferSize=100000
yugabyte.copyFlushEvery=50000
yugabyte.csvDelimiter=,
yugabyte.csvNull=
yugabyte.csvQuote="
yugabyte.csvEscape="
yugabyte.copyReplace=true

# YugabyteDB Transaction Settings
yugabyte.isolationLevel=READ_COMMITTED
yugabyte.autoCommit=false
yugabyte.disableTransactionalWrites=true

# =============================================================================
# Mapping Settings
# =============================================================================
mapping.mode=FLAT
mapping.idColumn=id
mapping.docColumn=doc
mapping.idType=TEXT

# Field-to-field mapping (only used in FLAT mode)
table.columnMapping._id=id
table.columnMapping.customerId=customer_id
table.columnMapping.orderTotal=order_total
table.columnMapping.status=status
table.columnMapping.createdAt=created_at

# Optional type casting (target column -> Spark SQL type)
table.typeMapping.id=STRING
table.typeMapping.order_total=DECIMAL(18,2)
table.typeMapping.created_at=TIMESTAMP

# =============================================================================
# Spark Job Configuration (example)
# =============================================================================
spark.executor.instances=4
spark.executor.cores=4
spark.executor.memory=8g
spark.executor.memoryOverhead=2048m
spark.driver.memory=4g
spark.default.parallelism=16
spark.sql.shuffle.partitions=16
spark.memory.fraction=0.8
spark.memory.storageFraction=0.2
spark.task.maxFailures=10
spark.stage.maxConsecutiveAttempts=4
spark.network.timeout=800s
spark.serializer=org.apache.spark.serializer.KryoSerializer
spark.dynamicAllocation.enabled=false
spark.dynamicAllocation.minExecutors=4
spark.dynamicAllocation.maxExecutors=8
spark.dynamicAllocation.initialExecutors=4

# =============================================================================
# Migration Settings
# =============================================================================
migration.checkpoint.enabled=true
migration.checkpoint.keyspace=public
migration.checkpoint.interval=10000
migration.validation.enabled=true
migration.validation.sampleSize=1000

# =============================================================================
# Target Table Configuration
# =============================================================================
table.target.schema=public
table.target.table=transactions_flat
table.validate=true
